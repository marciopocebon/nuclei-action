name: "Nuclei Scanning - Action"
description: ""

inputs:
  urls-txt:
    description: "List of urls to run templates"
    required: true
  slack-token:
    description: "Slack token"
    required: true
  slack-channel:
    description: "Slack channel"
    required: true

runs:
  using: "composite"

  steps:
    - run: GO111MODULE=on go get -u -v github.com/projectdiscovery/nuclei/v2/cmd/nuclei
      shell: bash
    - run: |
        $HOME/go/bin/nuclei -l $GITHUB_WORKSPACE/${{ inputs.urls-txt }} \
          -json \
          -update-directory . \
          -update-templates \
          -t nuclei-templates/cves/ \
          -t nuclei-templates/files/ \
          -t nuclei-templates/security-misconfiguration/ \
          -t nuclei-templates/subdomain-takeover/ \
          -t nuclei-templates/vulnerabilities/ \
          -o output.txt
      shell: bash
    - run: |
        git clone https://github.com/aqme/appsec-etl.git
        python3 -m pip install --upgrade pip
        python3 -m venv venv
        source venv/bin/activate
        pip3 install slackclient
        cat output.txt | python appsec-etl/transform/nuclei.py | python appsec-etl/load/toslack.py ${{ inputs.slack-token }} ${{ inputs.slack-channel }}
      shell: bash
